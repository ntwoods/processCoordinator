<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NT Woods ‚Äî Process Coordinator Portal</title>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Theme: White & Blue Shades -->
  <style>
    :root{
      --bg:#f7faff;            /* page bg */
      --bg-soft:#eef5ff;       /* soft blue background tint */
      --panel:#ffffff;         /* cards / sections */
      --text:#0f172a;          /* slate-900 */
      --muted:#475569;         /* slate-600 */
      --blue-50:#eff6ff;
      --blue-100:#dbeafe;
      --blue-200:#bfdbfe;
      --blue-300:#93c5fd;
      --blue-500:#3b82f6;
      --blue-600:#2563eb;
      --blue-700:#1d4ed8;
      --ok:#10b981;
      --warn:#ef4444;
      --ring:#60a5fa;
      --radius:16px;
      --shadow:0 10px 30px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    }

    /* --- Header --- */
    .header{
      position:sticky; top:0; z-index:30;
      background: linear-gradient(180deg, var(--blue-600), var(--blue-700));
      color:#fff; box-shadow:var(--shadow);
    }
    .header-inner{
      max-width:1280px; margin:0 auto; padding:12px 16px;
      display:flex; align-items:center; justify-content:space-between;
    }
    .brand{ display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px; }
    .brand .logo{ font-size:22px; }
    .theme-toggle{
      background:#fff; color:var(--blue-700);
      border:none; border-radius:999px; padding:10px 14px;
      font-weight:700; cursor:pointer;
      box-shadow:0 6px 18px rgba(255,255,255,.25);
    }
    .theme-toggle:focus-visible{ outline:3px solid #fff; outline-offset:2px; }

    /* --- Layout --- */
    .shell{
      max-width:1280px; margin:18px auto; padding:0 16px;
      display:grid; grid-template-columns:280px 1fr; gap:18px;
    }
    @media (max-width:1024px){ .shell{ grid-template-columns:1fr; } }

    /* --- Sidebar --- */
    aside.sidebar{
      background:var(--panel); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:14px; position:sticky; top:84px; align-self:start;
    }
    .sidebar-title{
      margin:2px 2px 10px; font-size:14px; color:#1e293b; letter-spacing:.3px; opacity:.8; font-weight:800;
    }
    .sidebar-nav{ display:flex; flex-direction:column; gap:8px; }
    .nav-link{
      display:flex; align-items:center; gap:10px; text-decoration:none;
      background:var(--blue-50); color:#0f172a; border:1px solid var(--blue-100);
      padding:10px 12px; border-radius:12px;
      transition: transform .15s ease, background-color .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .nav-link .emoji{ font-size:18px; }
    .nav-link:hover{ transform:translateY(-1px); background:var(--blue-100); }
    .nav-link.active{ border-color:var(--blue-300); box-shadow:0 0 0 3px var(--blue-100); }
    .nav-link:focus-visible{ outline:3px solid var(--ring); outline-offset:2px; }

    /* --- Content --- */
    main.content{ display:flex; flex-direction:column; gap:22px; }
    section.section{
      background:var(--panel); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:18px;
    }
    .section-head{
      display:flex; align-items:center; justify-content:space-between; gap:14px; margin-bottom:12px;
    }
    .section-title{
      margin:0; font-weight:800; letter-spacing:.2px; color:var(--blue-700);
      display:flex; align-items:center; gap:10px;
    }
    .section-cta{ display:flex; gap:8px; flex-wrap:wrap; }
    .chip{
      background:var(--blue-50); color:#0f172a; border:1px solid var(--blue-100);
      padding:6px 10px; border-radius:999px; font-size:12px; font-weight:700;
    }

    /* --- Grids --- */
    .grid-3{
      display:grid; gap:14px;
      grid-template-columns:repeat(3, minmax(0,1fr));
    }
    @media (max-width:900px){ .grid-3{ grid-template-columns:repeat(2,minmax(0,1fr)); } }
    @media (max-width:600px){ .grid-3{ grid-template-columns:1fr; } }

    .grid-auto{
      display:grid; gap:14px;
      grid-template-columns:repeat(auto-fill, minmax(220px,1fr));
    }

    /* --- Cards (used by script.js) --- */
    .card{
      background: linear-gradient(180deg, #ffffff, var(--bg-soft));
      border:1px solid var(--blue-100);
      border-radius:14px; padding:16px; cursor:pointer;
      transition: transform .15s ease, box-shadow .15s ease, background-color .15s ease, border-color .15s ease;
      opacity:1; transform:translateY(0);
    }
    .card:hover{ transform: translateY(-3px); box-shadow:var(--shadow); }
    .card:focus-visible{ outline:3px solid var(--ring); outline-offset:3px; transform:translateY(-3px); }
    .card .icon{ font-size:22px; }
    .card .title{ margin:8px 0 4px; font-weight:800; }
    .card .count{ font-weight:800; color:var(--muted); }

    /* script.js states */
    .card.loading{ opacity:.5; }
    .card.has-pending{ border-color:#fecaca; box-shadow:0 0 0 0 rgba(239, 68, 68, .25); animation: pulse 1.2s ease-out infinite; }
    .card.all-clear{ border-color:#a7f3d0; background:linear-gradient(180deg, #ffffff,#e8fff4); }
    .card.error-state{ border-color:#fca5a5; background:linear-gradient(180deg,#fff1f2,#ffe4e6); }

    /* --- Inventory / Claim tiles (inline JS paints red/green/pulse) --- */
    .invgrid{ display:grid; gap:14px; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); }
    .invcard{
      background:#fff; border-radius:14px; padding:16px; text-align:center;
      border:2px solid #e5e7eb; transition: transform .15s ease, box-shadow .15s ease, border-color .15s ease;
    }
    .invcard:hover{ transform:translateY(-3px); }
    .invcard h3{ margin:6px 0 6px; font-size:1.05rem; font-weight:800; }
    .invcard .count{ font-weight:800; }
    .invcard.red{ border-color:#fecaca; background:#fee2e2; }
    .invcard.green{ border-color:#bbf7d0; background:#dcfce7; }
    .pulse{ animation:pulse 1.4s ease-out infinite; }
    @keyframes pulse{
      0%{ box-shadow:0 0 0 0 rgba(239,68,68,.35); }
      70%{ box-shadow:0 0 0 10px rgba(239,68,68,0); }
      100%{ box-shadow:0 0 0 0 rgba(239,68,68,0); }
    }
    @media (prefers-reduced-motion:reduce){
      .pulse{ animation:none !important; }
      .card, .nav-link{ transition:none !important; }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-inner">
      <div class="brand"><span class="logo">üå≤</span><span>NT Woods ‚Äî PC Dashboard</span></div>
      <button class="theme-toggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">üåì Toggle Theme</button>
    </div>
  </header>

  <!-- Shell -->
  <div class="shell">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-title">NAVIGATION</div>
      <nav class="sidebar-nav">
        <a class="nav-link" href="#o2d-monitoring"><span class="emoji">üìä</span><span>O2D Monitoring</span></a>
        <a class="nav-link" href="#crm-tasks"><span class="emoji">üë•</span><span>CRM Tasks</span></a>
        <a class="nav-link" href="#purchase-management"><span class="emoji">üíº</span><span>Purchase Management</span></a>
        <a class="nav-link" href="#inventory-audit"><span class="emoji">üßæ</span><span>Inventory Audit</span></a>
        <a class="nav-link" href="#claim-management"><span class="emoji">üõÑ</span><span>Claim Management</span></a>
      </nav>

      <div class="sidebar-title" style="margin-top:14px;">QUICK LINKS</div>
      <nav class="sidebar-nav">
        <a class="nav-link" href="https://ntwoods.github.io/ordertodispatch/O2DjourneyPC.html" target="_blank"><span class="emoji">üê¶‚Äçüî•</span><span>O2D Journey</span></a>
        <a class="nav-link" href="https://ntwoods.github.io/ordertodispatch/completedSalesOrders.html" target="_blank"><span class="emoji">üõí</span><span>Completed SO</span></a>
        <a class="nav-link" href="https://ntwoods.github.io/processCoordinator/scotPC.html" target="_blank"><span class="emoji">ü•É</span><span>SCOT Portal</span></a>
      </nav>
    </aside>

    <!-- Main -->
    <main class="content">

      <!-- 1) O2D Monitoring (Top 3 tiles) -->
      <section class="section" id="o2d-monitoring">
        <div class="section-head">
          <h2 class="section-title">üìä O2D Monitoring</h2>
          <div class="section-cta">
            <span class="chip">Live</span>
            <span class="chip">Auto-refresh 30s</span>
          </div>
        </div>
        <div class="grid-3">
          <!-- IDs must match script.js apiMap -->
          <a class="card loading" id="crmAssignCard" href="https://ntwoods.github.io/ordertodispatch/L00.html?mode=view">
            <div class="icon">üéØ</div>
            <div class="title">CRM Assigning Pending</div>
            <div class="count" id="crmAssignCount">Loading‚Ä¶</div>
          </a>

          <a class="card loading" id="ownersApprovalCard" href="https://ntwoods.github.io/ordertodispatch/OwnerApprovalSOview.html">
            <div class="icon">‚úÖ</div>
            <div class="title">Owner‚Äôs Approval</div>
            <div class="count" id="ownersApprovalCount">Loading‚Ä¶</div>
          </a>

          <a class="card loading" id="dispatchConfirmCard" href="https://ntwoods.github.io/ordertodispatch/DispatchTeam.html?mode=view">
            <div class="icon">üöõ</div>
            <div class="title">Dispatch Team</div>
            <div class="count" id="dispatchConfirmCount">Loading‚Ä¶</div>
          </a>
        </div>
      </section>

      <!-- 2) CRM Tasks -->
      <section class="section" id="crm-tasks">
        <div class="section-head">
          <h2 class="section-title">üë• CRM Tasks</h2>
          <div class="section-cta">
            <span class="chip">O2D Stages</span>
          </div>
        </div>
        <div class="grid-auto">
          <!-- IDs exactly as script.js expects -->
          <a class="card small loading" id="crmLevel1Card" href="https://ntwoods.github.io/ordertodispatch/L1.html?mode=view">
            <div class="icon">1Ô∏è‚É£</div><div class="title">Credit & Stock Check</div>
            <div class="count" id="crmLevel1Count">Loading‚Ä¶</div>
          </a>
          <a class="card small loading" id="crmLevel2Card" href="https://ntwoods.github.io/ordertodispatch/L2.html?mode=view">
            <div class="icon">2Ô∏è‚É£</div><div class="title">Dealer Call & Update</div>
            <div class="count" id="crmLevel2Count">Loading‚Ä¶</div>
          </a>
          <a class="card small loading" id="crmLevel3Card" href="https://ntwoods.github.io/ordertodispatch/L3.html?mode=view">
            <div class="icon">3Ô∏è‚É£</div><div class="title">Tentative Dispatch Date</div>
            <div class="count" id="crmLevel3Count">Loading‚Ä¶</div>
          </a>
          <a class="card small loading" id="crmLevel4Card" href="https://ntwoods.github.io/ordertodispatch/L4.html?mode=view">
            <div class="icon">4Ô∏è‚É£</div><div class="title">Dispatch Reminder</div>
            <div class="count" id="crmLevel4Count">Loading‚Ä¶</div>
          </a>
          <a class="card small loading" id="crmLevel5Card" href="https://ntwoods.github.io/ordertodispatch/L5.html?mode=view">
            <div class="icon">5Ô∏è‚É£</div><div class="title">Dispatch Info to Dealer</div>
            <div class="count" id="crmLevel5Count">Loading‚Ä¶</div>
          </a>
          <a class="card small loading" id="crmLevel6Card" href="https://ntwoods.github.io/ordertodispatch/L6.html?mode=view">
            <div class="icon">6Ô∏è‚É£</div><div class="title">Delivery Confirmation</div>
            <div class="count" id="crmLevel6Count">Loading‚Ä¶</div>
          </a>
          <a class="card small loading" id="crmLevel7Card" href="https://ntwoods.github.io/ordertodispatch/L7.html?mode=view">
            <div class="icon">7Ô∏è‚É£</div><div class="title">Hold Order Management</div>
            <div class="count" id="crmLevel7Count">Loading‚Ä¶</div>
          </a>
        </div>
      </section>

      <!-- 3) Purchase Management -->
      <section class="section" id="purchase-management">
        <div class="section-head">
          <h2 class="section-title">üíº Purchase Management</h2>
          <div class="section-cta"><span class="chip">PO Flow</span></div>
        </div>
        <div class="grid-auto">
          <!-- IDs exactly as script.js expects -->
          <a class="card loading" id="purchaseVerifyCard" href="https://ntwoods.github.io/PurchaseOrders/POverifier.html?mode=view">
            <div class="icon">üîç</div><div class="title">PO Verification</div>
            <div class="count" id="purchaseVerifyCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="poSupplierCard" href="https://ntwoods.github.io/PurchaseOrders/SendToSupplier.html?mode=view">
            <div class="icon">üì§</div><div class="title">Send PO to Supplier</div>
            <div class="count" id="poSupplierCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="getDispatchDateCard" href="https://ntwoods.github.io/PurchaseOrders/GetDispatchDate.html?mode=view">
            <div class="icon">üìÖ</div><div class="title">Get Dispatch Date</div>
            <div class="count" id="getDispatchDateCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="dispatchFollowUpCard" href="https://ntwoods.github.io/PurchaseOrders/DispatchFollowUp.html?mode=view">
            <div class="icon">üìû</div><div class="title">Dispatch Follow Up</div>
            <div class="count" id="dispatchFollowUpCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="dispatchFollowUpADayBeforeCard" href="https://ntwoods.github.io/PurchaseOrders/DispatchFollowUpADayBefore.html?mode=view">
            <div class="icon">üìû</div><div class="title">Dispatch Follow Up A Day Before</div>
            <div class="count" id="dispatchFollowUpADayBeforeCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="getDispatchDetailsCard" href="https://ntwoods.github.io/PurchaseOrders/GetDispatch&LR.html?mode=view">
            <div class="icon">üìã</div><div class="title">Get Dispatch & LR Details</div>
            <div class="count" id="getDispatchDetailsCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="receivedAtGodown" href="https://ntwoods.github.io/PurchaseOrders/ReceivedAtGodown.html?mode=view">
            <div class="icon">üì¶</div><div class="title">Goods Received At Godown</div>
            <div class="count" id="receivedAtGodownCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="manageHoldPOCard" href="https://ntwoods.github.io/PurchaseOrders/manageHoldPO.html?mode=view">
            <div class="icon">üßä</div><div class="title">Manage Hold PO</div>
            <div class="count" id="manageHoldPOCount">Loading‚Ä¶</div>
          </a>
          <a class="card loading" id="acPortal" href="https://ntwoods.github.io/PurchaseOrders/AcDashboard.html?mode=view">
            <div class="icon">üìä</div><div class="title">Accounts Portal</div>
            <div class="count" id="acPortalCount">Loading‚Ä¶</div>
          </a>
          <a class="card" href="https://ntwoods.github.io/PurchaseOrders/PO_WATCH">
            <div class="icon">üéØ</div><div class="title">360¬∞ PO Watch</div>
            <div class="count">Monitor All</div>
          </a>
        </div>
      </section>

      <!-- 4) Inventory Audit Management (Inline JS for counts) -->
      <section class="section" id="inventory-audit">
        <div class="section-head">
          <h2 class="section-title">üßæ Inventory Audit Management</h2>
        </div>
        <div class="invgrid">
          <a class="invcard" id="card-start" href="https://ntwoods.github.io/audit/startAudit.html?mode=view">
            <h3>START AUDIT</h3><div class="count" id="count-start">Loading‚Ä¶</div>
          </a>
          <a class="invcard" id="card-verify-audit" href="https://ntwoods.github.io/audit/verifyAudit.html?mode=view">
            <h3>VERIFY AUDIT</h3><div class="count" id="count-verify-audit">Loading‚Ä¶</div>
          </a>
          <a class="invcard" id="card-journal" href="https://ntwoods.github.io/audit/journalEntry.html?mode=view">
            <h3>JOURNAL ENTRY</h3><div class="count" id="count-journal">Loading‚Ä¶</div>
          </a>
          <a class="invcard" id="card-verify" href="https://ntwoods.github.io/audit/verifyJournalEntry?mode=view">
            <h3>VERIFY JOURNAL ENTRIES</h3><div class="count" id="count-verify">Loading‚Ä¶</div>
          </a>
          <a class="invcard" id="card-account" href="https://ntwoods.github.io/audit/tallyTask?mode=view">
            <h3>ACCOUNT WORKING</h3><div class="count" id="count-account">Loading‚Ä¶</div>
          </a>
        </div>
      </section>

      <!-- 5) Claim Management (Inline JS for counts) -->
      <section class="section" id="claim-management">
        <div class="section-head">
          <h2 class="section-title">üõÑ Claim Management</h2>
        </div>
        <div class="invgrid">
          <a class="invcard" id="card-crm" href="https://ntwoods.github.io/ordertodispatch/informOwnersClaimReq.html?mode=view">
            <h3>Claims at CRM End</h3><div class="count" id="count-crm">Loading‚Ä¶</div>
          </a>
          <a class="invcard" id="card-acc" href="https://ntwoods.github.io/ordertodispatch/claimRequestAtAccounts.html?mode=view">
            <h3>Claims at Accounts End</h3><div class="count" id="count-acc">Loading‚Ä¶</div>
          </a>
        </div>
      </section>

    </main>
  </div>

  <!-- ===== External: script.js (loads counts for Top-3 + CRM + Purchase) ===== -->
  <script src="script.js"></script>

  <!-- ===== Enhance: make sidebar links smooth/active, trigger initial refresh ===== -->
  <script>
    // Toggle dark-mode class (script.js also has one; keeping simple local toggle to avoid conflicts)
    function toggleDarkMode(){ document.body.classList.toggle('dark-mode'); }

    // If your script.js exposes setupSmoothScrollAndActiveLinks/refreshAllCounts, call them:
    if (typeof setupSmoothScrollAndActiveLinks === 'function') {
      setupSmoothScrollAndActiveLinks();
    }
    if (typeof refreshAllCounts === 'function') {
      refreshAllCounts(); // initial paint for top-3 + CRM + Purchase
    }
  </script>

  <!-- ===== Inline JS: Inventory + Claims counts (as requested) ===== -->
  <script>
    (function(){
      const endpoints = {
        start:  "https://script.google.com/macros/s/AKfycbze820nXuy0s0RZNajlPzFq4AeyEaOhjp3IS_tqfi2RB7XKbzYvOi2nwXFUEUqtXh56/exec?action=pending",
        verifyAudit: "https://script.google.com/macros/s/AKfycbze820nXuy0s0RZNajlPzFq4AeyEaOhjp3IS_tqfi2RB7XKbzYvOi2nwXFUEUqtXh56/exec?action=error",
        journal: "https://script.google.com/macros/s/AKfycbze820nXuy0s0RZNajlPzFq4AeyEaOhjp3IS_tqfi2RB7XKbzYvOi2nwXFUEUqtXh56/exec?action=verifyerror",
        verify: "https://script.google.com/macros/s/AKfycbze820nXuy0s0RZNajlPzFq4AeyEaOhjp3IS_tqfi2RB7XKbzYvOi2nwXFUEUqtXh56/exec?action=journalentry",
        account: "https://script.google.com/macros/s/AKfycbze820nXuy0s0RZNajlPzFq4AeyEaOhjp3IS_tqfi2RB7XKbzYvOi2nwXFUEUqtXh56/exec?action=verifiedjournalentry",
        crm: 'https://script.google.com/macros/s/AKfycbw8K5xr1V52_zKMfy9gJyWZE0kuxsu0Gjoo2bdNfIXz9-zDDxFCHp2i4mdrLDZxs-BFbA/exec',
        acc: 'https://script.google.com/macros/s/AKfycbz0AMQP0qbmcpDl85pjfhF-0B1PW1GxQz_qRJj0ShDS0Pf4-CgVjslrY8CFmfX_hbzdeg/exec',
      };

      async function fetchData(url){
        const u = new URL(url); u.searchParams.set("_", Date.now());
        try{
          const res = await fetch(u, { cache:"no-store" });
          if(!res.ok) return [];
          const json = await res.json();
          if(Array.isArray(json)) return json;
          if(json && Array.isArray(json.data)) return json.data;
          if(json && json.success===true && Array.isArray(json.records)) return json.records;
          return [];
        }catch{ return []; }
      }
      function paint(el, count){
        if(!el) return; el.classList.remove("red","green","pulse");
        const c = el.querySelector(".count"); if(!c) return;
        if(count>0){ el.classList.add("red","pulse"); c.textContent = count + " pending"; }
        else{ el.classList.add("green"); c.textContent = "All Clear"; }
      }
      async function loadInvAndClaims(){
        try{
          const [s,va,j,v,a,cc,ca] = await Promise.all([
            fetchData(endpoints.start),
            fetchData(endpoints.verifyAudit),
            fetchData(endpoints.journal),
            fetchData(endpoints.verify),
            fetchData(endpoints.account),
            fetchData(endpoints.crm),
            fetchData(endpoints.acc),
          ]);
          paint(document.getElementById("card-start"), s.length);
          paint(document.getElementById("card-verify-audit"), va.length);
          paint(document.getElementById("card-journal"), j.length);
          paint(document.getElementById("card-verify"), v.length);
          paint(document.getElementById("card-account"), a.length);
          paint(document.getElementById("card-crm"), cc.length);
          paint(document.getElementById("card-acc"), ca.length);
        }catch(e){
          ["card-start","card-verify-audit","card-journal","card-verify","card-account","card-crm","card-acc"].forEach(id=>{
            const el=document.getElementById(id); if(!el) return;
            const c=el.querySelector(".count"); if(c) c.textContent="Error";
          });
        }
      }
      loadInvAndClaims();
    })();
  </script>
</body>
</html>
